# Домашнее задание к занятию «ELK - Рыхлик ИА»

---
https://mirror.yandex.ru/mirrors/elastic/8/pool/main/
---

### Задание 1. Elasticsearch 

Установите и запустите Elasticsearch, после чего поменяйте параметр cluster_name на случайный. 

*Приведите скриншот команды 'curl -X GET 'localhost:9200/_cluster/health?pretty', сделанной на сервере с установленным Elasticsearch. Где будет виден нестандартный cluster_name*.

---

### Решение 1. Elasticsearch 

Установите и запустите Elasticsearch, после чего поменяйте параметр cluster_name на случайный. 
Для установки будем использовать зеркало  https://mirror.yandex.ru/mirrors/elastic/8/pool/main/

```
# установка Elasticsearch
sudo apt install curl
sudo apt install apt-transport-https
wget https://mirror.yandex.ru/mirrors/elastic/8/pool/main/e/elasticsearch/elasticsearch-8.14.3-amd64.deb
sudo apt install ./elasticsearch-8.14.3-amd64.deb
```


вносим изменения в конфигурационного файла elasticsearch
sudo nano /etc/elasticsearch/elasticsearch.yml

```
cluster.name:*******
# для получения ответа отключаем xpack.security.enabled
xpack.security.enabled: False
```
запускаем Elasticsearch
```
sudo systemctl daemon-reload
sudo systemctl enable elasticsearch.service
sudo systemctl start elasticsearch.service
sudo systemctl status elasticsearch.service
```

![11-3-1-elasticsearch](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-1-elasticsearch.png?raw=true)

отпраляем запрос из задания

```
curl -X GET 'localhost:9200/_cluster/health?pretty'
```

![11-3-2-elasticsearch](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-2-elasticsearch.png?raw=true)

---

### Задание 2. Kibana

Установите и запустите Kibana.

*Приведите скриншот интерфейса Kibana на странице http://<ip вашего сервера>:5601/app/dev_tools#/console, где будет выполнен запрос GET /_cluster/health?pretty*.

---

### Решение 2. Kibana

```
# установка kibana
wget https://mirror.yandex.ru/mirrors/elastic/8/pool/main/k/kibana/kibana-8.14.3-amd64.deb
sudo apt install ./kibana-8.14.3-amd64.deb


```
Перед запуском внесем в кофигурационный файл kibana
sudo nano /etc/kibana/kibana.yml
Файл конфигурации [kibana.yml]()

Запуск служб Kibana
```
sudo systemctl daemon-reload  
sudo systemctl enable kibana.service  
sudo systemctl start kibana.service  
sudo systemctl status kibana.service  
```

![11-3-3-kibana](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-3-kibana.png?raw=true)

Заходим на 
```
http://192.168.100.146:5601/app/dev_tools#/console
```

Выполняем запрос
```
GET /_cluster/health?pretty
```
![11-3-4_kibana](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-4-kibana.png?raw=true)

---

### Задание 3. Logstash

Установите и запустите Logstash и Nginx. С помощью Logstash отправьте access-лог Nginx в Elasticsearch. 

*Приведите скриншот интерфейса Kibana, на котором видны логи Nginx.*

---

### Решение 3. Logstash

Установка NGINX & Logstash
```
sudo apt install nginx
wget https://mirror.yandex.ru/mirrors/elastic/8/pool/main/l/logstash/logstash-8.14.3-amd64.deb
sudo apt install ./logstash-8.14.3-amd64.deb
 

```


![11-3-5-logstash](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-5-logstash.png?raw=true)

Создаем конфиг 
sudo nano /etc/logstash/conf.d/logstash.conf

а также не забываем дать права logstash права на чтение фала с логом nginx

```
# Запуск службы logstash.
sudo systemctl daemon-reload 
sudo systemctl enable logstash.service  
sudo systemctl start logstash.service   
sudo systemctl status logstash.service  
```
![11-3-6-logstash](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-6-logstash.png?raw=true)

![11-3-7-logstash](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-7-logstash.png?raw=true)

![11-3-8-logstash](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-8-logstash.png?raw=true)

![11-3-9-logstash](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-9-logstash.png?raw=true)


---

### Задание 4. Filebeat. 

Установите и запустите Filebeat. Переключите поставку логов Nginx с Logstash на Filebeat. 

*Приведите скриншот интерфейса Kibana, на котором видны логи Nginx, которые были отправлены через Filebeat.*

---

### Решение 4. Filebeat. 

Установка Filebeat 

```
wget https://mirror.yandex.ru/mirrors/elastic/8/pool/main/f/filebeat/filebeat-8.14.3-amd64.deb
sudo apt install ./filebeat-8.14.3-amd64.deb

Берем готовый шаблон filebeat и настраиваем его

```
sudo mv /etc/filebeat/modules.d/nginx.yml.disabled /etc/filebeat/modules.d/nginx.yml
# вносим необходимые изменения в файл
nano /etc/filebeat/modules.d/nginx.yml
```
[nginx.yml]()
проверяем что у нас правильно настроен filebeat
```
filebeat test config -c /etc/filebeat/filebeat.yml
```
получаем ответ
```
Config OK
```
Запускаем службу Filebeat
```
sudo systemctl enable filebeat
sudo systemctl start filebeat
```


перенастраиваем logstash
nano /etc/filebeat/modules.d/nginx-filebeat.conf
[nginx-filebeat.yml]()

перезапускаем службу logstash
```
sudo systemctl restart logstash.service 
```
скриншоты kibana

![11-3-10-filebeat](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-10-filebeat.png?raw=true)

![11-3-11-filebeat](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-11-filebeat.png?raw=true)

![11-3-12-filebeat](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-12-filebeat.png?raw=true)

![11-3-13-filebeat](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-13-filebeat.png?raw=true)

![11-3-14-filebeat](https://github.com/ilaryhlik17854-stack/HW_DATABASES/blob/main/3%20-%20ELK/img/11-3-14-filebeat.png?raw=true)



